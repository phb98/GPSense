/************************************************************************************************************/
/*                                              INCLUDE                                                     */
/************************************************************************************************************/
#include "gps_parser.h"
#include "gps_parser_main.h"
#include "gps_def.h"
#include "GPSense_conf.h"
#include "gps_data.h"
/************************************************************************************************************/
/*                                     MACRO AND CONSTANT DEFINE                                            */
/************************************************************************************************************/
#define GROUND_SPEED_KMH_FIELD (6)
/************************************************************************************************************/
/*                                            MODULE TYPE                                                   */
/************************************************************************************************************/

/************************************************************************************************************/
/*                                          MODULE VARIABLE                                                 */
/************************************************************************************************************/

/************************************************************************************************************/
/*                                     PRIVATE FUNCTION PROTOTYPES                                          */
/************************************************************************************************************/

/************************************************************************************************************/
/*                                           PUBLIC FUNCTION                                                */
/************************************************************************************************************/
SUB_PARSER_DEFINE(VTG)
{
  if(!data.p_data)
  {
    GPS_LOGE("Invalid input");
    return;
  }
  uint8_t temp_buffer[32];
  if(gps_parser_get_data_field(data.p_data, data.data_len, GROUND_SPEED_KMH_FIELD, temp_buffer, sizeof(temp_buffer)))
  {
    gps_new_data_t new_data = 
    {
      .new_data_hdr.p_msg_id = data.p_msg_id,
      .new_data_hdr.msg_id_len = data.msg_id_len,
      .new_data_hdr.talker_id = data.talker_id,
      .new_data_hdr.type = GPS_DATA_GROUND_SPEED,
      .data.ground_speed.unit = GPS_UNIT_KMH
    };
    // get speed
    new_data.data.ground_speed.value = atof(temp_buffer);
    gps_data_add(&new_data);
  }
  else
  {
    GPS_LOGD("Fail to get ground speed kmh");
  }
}
/************************************************************************************************************/
/*                                          PRIVATE FUNCTION                                                */
/************************************************************************************************************/